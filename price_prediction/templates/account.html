{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroPrice</title>
    <link rel="stylesheet" href="{% static 'price_prediction/index.css' %}">
</head>
<body>
<header>
    {% include "navbar.html" %}
</header>
<div class="account-page">
    <div class="container">
        <div class="row">
            <div class="col-2">
                <img src="{% static 'price_prediction/images/ac.png' %}" width="120%">
            </div>
            <div class="col-2">
                <div class="form-container">
                    <div class="form-btn">
                        <span onclick="login()">Login</span>
                        <span onclick="register()">Register</span>
                        <hr id="Indicator">
                    </div>
                    <form id="LoginForm" method="post" action="{% url 'login' %}" onsubmit="return validateLoginForm()">
                        {% csrf_token %}
                        <input type="text" placeholder="Username" name="username">
                        <input type="password" placeholder="Password" name="password">
                        <button type="submit" class="btn">Login</button>
                    </form>
                    <form id="RegForm" method="post" action="{% url 'register' %}" onsubmit="return validateRegForm()">
                        {% csrf_token %}
                        <input type="text" placeholder="Username" name="username">
                        <input type="email" placeholder="Email" name="email">
                        <input type="password" placeholder="Password" name="password">
                        <button type="submit" class="btn">Register</button>
                        <!-- Error messages -->
                        <small id="registerUsernameError" class="error"></small>
                        <small id="registerEmailError" class="error"></small>
                        <small id="registerPasswordError" class="error"></small>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footer">
    <div class="container">
        <div class="footer-col-2">
            <img src="{% static 'price_prediction/images/vegetables1.png' %}">
            <p>Our purpose is to help you for vegetable price prediction.</p>
        </div>
        <div class="footer-col-4">
            <h3>Follow us</h3>
            <ul>
                <li>Facebook</li>
                <li>Instagram</li>
            </ul>
        </div>
    </div>
    <hr>
    <p class="copyright">Copyright 2024 - AgroPrice</p>
</div>

<!-- JavaScript for toggle menu -->
<script>
    var MenuItems = document.getElementById("MenuItems");
    MenuItems.style.maxHeight = "0px";
    function menutoggle(){
        if(MenuItems.style.maxHeight == "0px")
        {
            MenuItems.style.maxHeight = "200px"
        }
        else
        {
            MenuItems.style.maxHeight = "0px"
        }
    }
</script>

<!-- JavaScript for toggle Form -->
<script>
    var LoginForm = document.getElementById("LoginForm");
    var RegForm = document.getElementById("RegForm");
    var Indicator = document.getElementById("Indicator");
    function register()
    {
        RegForm.style.transform = "translateX(0px)";
        LoginForm.style.transform = "translateX(0px)";
        Indicator.style.transform = "translateX(100px)";
    }
    function login()
    {
        RegForm.style.transform = "translateX(300px)";
        LoginForm.style.transform = "translateX(300px)";
        Indicator.style.transform = "translateX(0px)";
    }
    function validateLoginForm() {
        const username = document.forms["LoginForm"]["username"].value.trim();
        const password = document.forms["LoginForm"]["password"].value.trim();

        if (username === "" || password === "") {
            alert("Please fill in all fields");
            return false;
        }

        return true;
    }

    function validateRegForm() {
        const username = document.forms["RegForm"]["username"].value.trim();
        const email = document.forms["RegForm"]["email"].value.trim();
        const password = document.forms["RegForm"]["password"].value.trim();

        if (username === "" || email === "" || password === "") {
            alert("Please fill in all fields");
            return false;
        }
        const isEmailTaken = checkEmailExists(email);
        if (isEmailTaken) {
            alert("Email is already taken");
            return false;
        }

        alert("Successfully Registered");
        return true;
    }
    function checkEmailExists(email) {
        return fetch('/check_email/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken') // Include CSRF token
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            return data.exists;
        })
        .catch(error => {
            console.error('Error: ', error);
            return false;
        });
    }

    // Function to get CSRF token from cookies
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
</script>

</body>
</html>
